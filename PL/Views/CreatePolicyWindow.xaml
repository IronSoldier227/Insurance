<!-- PL/Views/CreatePolicyWindow.xaml -->
<Window x:Class="PL.CreatePolicyWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Оформление страхового полиса" 
        Height="550" 
        Width="500"
        WindowStartupLocation="CenterOwner">

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Информация об автомобиле -->
        <GroupBox Grid.Row="0" Header="Автомобиль" Margin="0,0,0,10">
            <StackPanel>
                <TextBlock Text="{Binding SelectedVehicle.PlateNum, StringFormat='Гос. номер: {0}'}" 
                          FontWeight="Bold" Margin="0,0,0,5"/>
                <TextBlock Text="{Binding SelectedVehicle.Brand, StringFormat='Марка: {0}'}" Margin="0,0,0,2"/>
                <TextBlock Text="{Binding SelectedVehicle.Model, StringFormat='Модель: {0}'}" Margin="0,0,0,2"/>
                <TextBlock Text="{Binding SelectedVehicle.PowerHp, StringFormat='Мощность: {0} л.с.'}" Margin="0,0,0,2"/>
                <TextBlock Text="{Binding SelectedVehicle.YearOfProduction, StringFormat='Год выпуска: {0}'}" Margin="0,0,0,2"/>
            </StackPanel>
        </GroupBox>

        <!-- Форма страховки -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- Тип страховки -->
                <TextBlock Text="Тип страховки" FontWeight="Bold" Margin="0,0,0,5"/>
                <ComboBox ItemsSource="{Binding PolicyTypes}" 
                         SelectedItem="{Binding SelectedPolicyType}"
                         Margin="0,0,0,15"/>

                <!-- Срок действия -->
                <TextBlock Text="Срок действия " FontWeight="Bold" Margin="0,0,0,5"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                    <RadioButton Content="12 месяцев" IsChecked="{Binding PolicyDurationMonths, Converter={StaticResource IntToBoolConverter}, ConverterParameter=12}" 
                               Margin="0,0,10,0"/>
                    <RadioButton Content="6 месяцев" IsChecked="{Binding PolicyDurationMonths, Converter={StaticResource IntToBoolConverter}, ConverterParameter=6}" 
                               Margin="0,0,10,0"/>
                </StackPanel>

                <!-- Расчет стоимости -->
                <!-- ... -->
                <GroupBox Header="Расчет стоимости" Margin="0,0,0,15">
                    <StackPanel>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <!-- Для итоговой цены с учётом срока -->
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Базовая ставка:"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding BasePrice, StringFormat={}{0:N2}₽}"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Коэффициент мощности:"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding PowerCoefficient, StringFormat={}{0:0.00}}"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Коэффициент стажа:"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding ExperienceCoefficient, StringFormat={}{0:0.00}}"/>

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Коэффициент бонус-малус:"/>
                            <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding BonusMalusCoefficient, StringFormat={}{0:0.00}}"/>

                            <Separator Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,5,0,5"/>


                            <TextBlock Grid.Row="6" Grid.Column="0" Text="Итоговая стоимость (с учётом срока):" FontWeight="Bold"/>
                            <TextBlock Grid.Row="6" Grid.Column="1" Text="{Binding FinalPriceForUser, StringFormat={}{0:N2}₽}" 
                      FontWeight="Bold" Foreground="Green" FontSize="14"/>
                        </Grid>
                    </StackPanel>
                </GroupBox>
                <!-- ... -->

                <!-- Сообщение об ошибке -->
                <TextBlock Text="{Binding ErrorMessage}" 
                          Foreground="Red" 
                          TextWrapping="Wrap"
                          Margin="0,0,0,10"
                          Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}"/>
            </StackPanel>
        </ScrollViewer>

        <!-- Кнопки -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Отмена" 
                   Command="{Binding CancelCommand}"
                   Width="80"
                   Margin="0,0,10,0"/>
            <Button Content="Оформить полис" 
                   Command="{Binding CreatePolicyCommand}"
                   Width="120"
                   Background="#FF0D6EFD"
                   Foreground="White"
                   FontWeight="Bold"/>
        </StackPanel>
    </Grid>
</Window>